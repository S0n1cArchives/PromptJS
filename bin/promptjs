#! /usr/bin/env node

const process = require('process');
const readline = require('readline');


class PromptJS {
    constructor() {
        this.name = "PromptJS";
        this.version = "1.0";
        this.user = {
            username: process.env.USER || process.env.USERNAME.toLowerCase()
        }
        this.rl = readline.createInterface({
            input: process.stdin,
            output: process.stdout,
            prompt: `${this.user.username}@promptjs:~#`
        });
        console.log(`${this.name} v${this.version}`)
       // console.log(process.env);


        this.rl.prompt();

        this.rl.on('line', (line) => {
            const cmd = line.trim();
            switch (line.trim()) {
                case '.quit':
                    console.log("Bye!")
                    return process.exit(0);
                    break;
                default:
                    this.parseCmd(cmd);
                    break;
            }
            rl.prompt();
        }).on('close', () => {
           // console.log()
            console.log('\nHave a great day!');
            process.exit(0);
        });


    }

    parseCmd(cmd) {
        const parse = (cmd) => {
            //if(afterPrefix.contains)
            const splitCommands = cmd.split("|")
            splitCommands.forEach((com, i) => {
                splitCommands[i] = com.trim();
            })
            /*const shellTest = afterPrefix.match(/^.*(?=\s\|)/g);
            console.log(shellTest, afterPrefix);
            if(shellTest == null) {
                return {
                    status: false,
                    type: 404,
                    data: "no match"
                }
            }*/

            const commands = [];

            splitCommands.forEach(com => {
                console.log(com);
                const parts = com.split(/\s/g);
                const command = parts[0];
                var args = parts.splice(1, parts.length);
              //  console.log(args)
                args = args.filter((arg) => {
                    if(arg.length > 0) {
                   //     console.log(arg);
                        return true;
                    }
                })
               // console.log(a)
                args.forEach((arg, i) => {
                    
                    try {
                        args[i] = JSON.parse(arg.trim());
                    } catch (e) {
                        void(0);
                    }

                    arg = arg.trim();

                })
                commands.push({
                    command: command,
                    args: args,
                })
            });
            return commands;
        }

        console.log(parse(cmd))
    }
}

module.exports = PromptJS;

const prompt = new PromptJS();